<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

<link rel="icon" href="https://carrieres.econocom.com/wp-content/uploads/sites/244/2022/05/FAVICON_ECONOCOM-512-blue.png" sizes="32x32" />
<link rel="icon" href="https://carrieres.econocom.com/wp-content/uploads/sites/244/2022/05/FAVICON_ECONOCOM-512-blue.png" sizes="192x192" />

    <title>Test technique PLM</title>
</head>
<body>

<div class="container">
    <div class="row">
        <div class="col-lg-6">
            <h3>Liste des Pilotes</h3>
            <table class="display compact nowrap" id="pilotes-table">
                <thead>
                <tr>
                    <th>Id</th>
                    <th>Nom</th>
                    <th>Adresse</th>
                </tr>
                </thead>
                <tbody id="pilots-table-body">
                </tbody>
            </table>
        </div>

        <div class="col-lg-6">
            <h3>Liste des Avions</h3>
            <table class="display compact nowrap" id="avions-table">
                <thead>
                <tr>
                    <th>Numéro</th>
                    <th>Nom</th>
                    <th>Capacité</th>
                    <th>Localisation</th>
                </tr>
                </thead>
                <tbody id="avions-table-body">
                </tbody>
            </table>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <button id="button" class="btn btn-primary">Rechercher</button>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <h3>Liste des Vols</h3>
            <table class="table table-sm table-striped compact" id="vols-table">
                <thead>
                <tr>
                    <th>N° pilote</th>
                    <th>N° avion</th>
                    <th>Ville de départ</th>
                    <th>Ville d'arrivée</th>
                    <th>Heure de départ</th>
                    <th>Heure d'arrivée</th>
                </tr>
                </thead>
                <tbody id="vols-table-body">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {

const apiUrl = "https://unique-spirit-407416.uc.r.appspot.com/api/";
const i18nFrUrl = 'https://cdn.datatables.net/plug-ins/1.13.7/i18n/fr-FR.json';

const tablePilotes = $('#pilotes-table').DataTable( {
                                       columns: [
                                           { data: 'numpilote' },
                                           { data: 'nompilote' },
                                           { data: 'adresse' }
                                       ],
                                       language: {
                                            url: i18nFrUrl
                                       }
                            });

const tableAvions = $('#avions-table').DataTable( {
                                      columns: [
                                          { data: 'numavion' },
                                          { data: 'nomavion' },
                                          { data: 'capacite' },
                                          { data: 'localisation' }
                                      ],
                                       language: {
                                            url: i18nFrUrl
                                       }
                            });

const tableVols = $('#vols-table').DataTable( {
                                        columns: [
                                            { data: 'numpilote' },
                                            { data: 'numavion' },
                                            { data: 'villedep' },
                                            { data: 'villearr' },
                                            { data: 'heuredep' },
                                            { data: 'heurearr' }
                                        ],
                                       language: {
                                            url: i18nFrUrl
                                       }
                              });


tablePilotes.on('click', 'tbody tr', function (e) {
   e.currentTarget.classList.toggle('selected');
});

tableAvions.on('click', 'tbody tr', function (e) {
   e.currentTarget.classList.toggle('selected');
});

fetch(apiUrl+"pilots")
    .then(response => response.json())
    .then(data => tablePilotes.rows.add(data).draw())
    .catch(error => console.error("Erreur lors de la récupération des données de l'API (pilotes):", error));

fetch(apiUrl+"avions")
    .then(response => response.json())
    .then(data => tableAvions.rows.add(data).draw())
    .catch(error => console.error("Erreur lors de la récupération des données de l'API (avions):", error));

document.querySelector('#button').addEventListener('click', function () {
    const pilotesId = tablePilotes.rows('.selected').data().pluck('numpilote').toArray();
    const avionsId = tableAvions.rows('.selected').data().pluck('numavion').toArray();

    fetch(apiUrl+"vols?pilots="+pilotesId.toString()+"&avions="+avionsId.toString())
        .then(response => response.json())
        .then(data => {
            tableVols.clear();
            tableVols.rows.add(data).draw();
        })
        .catch(error => console.error("Erreur lors de la récupération des données de l'API (vols):", error));
});
});

</script>


</body>
</html>

